/*
 * scheduler.h
 *
 *  Created on: Nov 16, 2025
 *      Author: kiman
 */

#ifndef INC_SCHEDULER_H_
#define INC_SCHEDULER_H_

#include <stdint.h>

#define SCH_MAX_TASKS   10
#define NO_TASK_ID      255


#define PED_TOTAL_TIME 10    // thời gian người đi bộ được đi
#define PED_BLINK_TIME 3     // 5s cuối nhấp nháy

#define PED_GREEN_CYCLES 3
#define MODE_1 1   // Auto
#define MODE_2 2   // Config RED
#define MODE_3 3   // Config YELLOW
#define MODE_4 4   // Config GREEN

#define AUTO_R1_G2 0
#define AUTO_R1_Y2 1
#define AUTO_G1_R2 2
#define AUTO_Y1_R2 3


typedef void (*TaskFunction_t)(void);

typedef struct {
    TaskFunction_t pTask;   // con trỏ hàm
    uint32_t       Delay;   // Delay (ticks)
    uint32_t       Period;  // Period (ticks)
    uint8_t        RunMe;   // Task ready count
} sTask;

/* task array & tick counter được khai báo trong scheduler.c */
extern sTask SCH_tasks[SCH_MAX_TASKS];
extern volatile uint32_t tick_ms;

/* API của scheduler */
void SCH_Init(void);
void SCH_Update(void);
void SCH_Dispatch_Tasks(void);
void Task_Display_Update(void);

uint8_t SCH_Add_Task(TaskFunction_t pFunction, uint32_t DELAY, uint32_t PERIOD);
uint8_t SCH_Delete_Task(uint8_t id);





void setPedestrian1LED(int red, int green);
void setPedestrian2LED(int red, int green);

//void check_pedestrian_button(void);
#endif /* INC_FSM_H_ */
